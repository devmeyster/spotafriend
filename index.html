<!DOCTYPE html>
  <head>
    <!-- Spotify CSS files -->
    <link rel="stylesheet" type="text/css" href="sp://resources/css/eve.css">
    <link rel="stylesheet" type="text/css" href="sp://resources/css/api.css">
    <link rel="stylesheet" type="text/css" href="sp://resources/css/player.css">
    <link rel="stylesheet" type="text/css" href="sp://resources/css/list.css">

    <!-- Project CSS files -->
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/github.css">
  </head>
  <body>
    <div id="wrapper">
      <div id="index" class="section">
        asdf
        <img src="/img/fb-login.png" id="fb-login" />
        <ul id="listens"></ul>
      </div>
    </div>
    <script src="/js/rainbow-custom.min.js"></script>
    <script src="/js/tutorial.js"></script>
    <script>
      /* Instantiate the global sp object; include auth */
      var sp = getSpotifyApi(),
        auth = sp.require('$api/auth'),
        app_id = '126891607432106',
        permissions = ['user_actions.music'],
        request_url = 'https://graph.facebook.com/me/music.listens',
        fbButtonHTML;

      window.onload = function(){
        fbButtonHTML = document.getElementById('fb-login');
        fbButtonHTML.addEventListener('click', authFB);
      }

      function authFB() {
        auth.authenticateWithFacebook(app_id, permissions, {
          onSuccess: function(accessToken, ttl) {
            fbButtonHTML.style.display = 'none';
            var url = 'https://graph.facebook.com/me?access_token=' + accessToken;
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url);
            xhr.onreadystatechange = function () {
            if (xhr.readyState != 4) return;
            var response = JSON.parse(xhr.responseText);
            handle(response);
            }
            xhr.send(null);
          },
          onFailure : function(error) {
            console.log('Authentication failed with error: ' + error);
          },
          onComplete : function() { }
        });
      }

      function handle(response) {
        var listens = document.getElementById('listens');
        listens.innerHTML = print(response);
      }

      // Recursive print of object
      var print = function( o, maxLevel, level ) {
        if ( typeof level == "undefined" ) {
          level = 0;
        }
        if ( typeof level == "undefined" ) {
          maxLevel = 0;
        }

        var str = '';
        // Remove this if you don't want the pre tag, but make sure to remove
        // the close pre tag on the bottom as well
        if ( level == 0 ) {
          str = '<pre>';
        }

        var levelStr = '';
        for ( var x = 0; x < level; x++ ) {
          levelStr += '    ';
        }

        if ( maxLevel != 0 && level >= maxLevel ) {
          str += levelStr + '...</br>';
          return str;
        }

        for ( var p in o ) {
          if ( typeof o[p] == 'string' ) {
            str += levelStr +
              p + ': ' + o[p] + ' </br>';
          } else {
            str += levelStr +
              p + ': { </br>' + print( o[p], maxLevel, level + 1 ) + levelStr + '}</br>';
          }
        }

        // Remove this if you don't want the pre tag, but make sure to remove
        // the open pre tag on the top as well
        if ( level == 0 ) {
          str += '</pre>';
        }
        return str;
      };
    </script>
  </body>
</html>
