<!DOCTYPE html>
  <head>
    <!-- Spotify CSS files -->
    <link rel="stylesheet" type="text/css" href="sp://resources/css/eve.css">
    <link rel="stylesheet" type="text/css" href="sp://resources/css/api.css">
    <link rel="stylesheet" type="text/css" href="sp://resources/css/player.css">
    <link rel="stylesheet" type="text/css" href="sp://resources/css/list.css">

    <!-- Project CSS files -->
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/github.css">
  </head>
  <body>
    <div id="wrapper">
      <div id="index" class="section">
        asdf
        <div id="accessToken"></div>
        <img src="/img/fb-login.png" id="fb-login" />
        <ul id="listens"></ul>
      </div>
    </div>
    <script src="/js/utils.js"></script>
    <script src="/js/rainbow-custom.min.js"></script>
    <script src="/js/tutorial.js"></script>
    <script>
      /* Instantiate the global sp object; include auth */
      var sp = getSpotifyApi(),
        auth = sp.require('$api/auth'),
        app_id = '126891607432106',
        permissions = ['user_actions.music'],
        request_url = 'https://graph.facebook.com/me/music.listens',
        fbButtonHTML;

      window.onload = function(){
        fbButtonHTML = document.getElementById('fb-login');
        fbButtonHTML.addEventListener('click', authFB);
      }

      function authFB() {
        auth.authenticateWithFacebook(app_id, permissions, {
          onSuccess: function(accessToken, ttl) {
            fbButtonHTML.style.display = 'none';
            var url = 'https://graph.facebook.com/me?fields=id,music.listens,friends&access_token=' + accessToken;
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url);
            document.getElementById('accessToken').innerHTML = accessToken;
            xhr.onreadystatechange = function () {
              if (xhr.readyState != 4) return;
              var response = JSON.parse(xhr.responseText);
              handle(response);
            }
            xhr.send(null);
          },
          onFailure : function(error) {
            console.log('Authentication failed with error: ' + error);
          },
          onComplete : function() { }
        });
      }

      function handle(response) {
        var listens = document.getElementById('listens');
        listens.innerHTML = print(response);
      }
    </script>
  </body>
</html>
